/* jquery.mlens v.1.3 | (c) 2012, 2013 Federica Sibella musings(at)musings(dot)it | http://www.musings.it | MIT or GPLv3 license.*/
(function(e){function r(b){if("string"===typeof b){var c=b.indexOf("_");-1!=c&&(b=b.substr(c+1))}return b}function s(b){b.complete?imgWidth=String(parseInt(b.width/2))+"px":window.setTimeout(s,100);return imgWidth}var n=[],l=0,t={init:function(b){this.each(function(){var c=e(this),a=c.data("mlens"),a=e(),f=e(),q=e(),k=e(),h=e(),g=e(),a=e.extend({lensShape:"square",lensSize:100,borderSize:4,borderColor:"#888",borderRadius:0,imgSrc:"",imgSrc2x:"",lensCss:"",imgOverlay:"",overlayAdapt:!0},b),d="auto";
""==a.imgSrc&&(g=c.attr("src"));""!=a.imgSrc2x&&1<window.devicePixelRatio?(g=a.imgSrc2x,k=new Image,k.onload=function(){d=String(parseInt(this.width/2))+"px"},k.src=g,d=s(k)):g=a.imgSrc;var h="background-position: 0px 0px;width: "+String(a.lensSize)+"px;height: "+String(a.lensSize)+"px;float: left;display: none;border: "+String(a.borderSize)+"px solid "+a.borderColor+";background-repeat: no-repeat;position: absolute;",m="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";
!0===a.overlayAdapt&&(m+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;");switch(a.lensShape){default:h=h+"border-radius:"+String(a.borderRadius)+"px;";m=m+"border-radius:"+String(a.borderRadius)+"px;";break;case "circle":h=h+"border-radius: "+String(a.lensSize/2+a.borderSize)+"px;",m=m+"border-radius: "+String(a.lensSize/2+a.borderSize)+"px;"}c.wrap("<div id='mlens_wrapper_"+l+"' />");k=c.parent();
k.css({width:c.width()});f=e("<div id='mlens_target_"+l+"' style='"+h+"' class='"+a.lensCss+"'>&nbsp;</div>").appendTo(k);h=e("<img style='display:none;width:"+d+";height:auto;max-width:none;max-height;none;' src='"+g+"' />").appendTo(k);f.css({backgroundImage:"url('"+g+"')",backgroundSize:d+" auto",cursor:"none"});""!=a.imgOverlay&&(q=e("<div id='mlens_overlay_"+l+"' style='"+m+"'>&nbsp;</div>"),q.css({backgroundImage:"url('"+a.imgOverlay+"')",cursor:"none"}),q.appendTo(f));c.attr("data-id","mlens_"+
l);c.data("mlens",{lens:c,options:a,target:f,imageTag:h,imgSrc:g,parentDiv:k,overlay:q,instance:l});a=c.data("mlens");n[l]=a;f.mousemove(function(a){e.fn.mlens("move",c.attr("data-id"),a)});c.mousemove(function(a){e.fn.mlens("move",c.attr("data-id"),a)});f.on("touchmove",function(a){a.preventDefault();a=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];e.fn.mlens("move",c.attr("data-id"),a)});c.on("touchmove",function(a){a.preventDefault();a=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];
e.fn.mlens("move",c.attr("data-id"),a)});c.hover(function(){f.show()},function(){f.hide()});f.hover(function(){f.show()},function(){f.hide()});c.on("touchstart",function(a){a.preventDefault();f.show()});c.on("touchend",function(a){a.preventDefault();f.hide()});f.on("touchstart",function(a){a.preventDefault();f.show()});f.on("touchend",function(a){a.preventDefault();f.hide()});l++;return n})},move:function(b,c){b=r(b);var a=n[b],f=a.lens,e=a.target,k=a.imageTag,h=f.offset(),g=parseInt(c.pageX-h.left),
d=parseInt(c.pageY-h.top),m=k.width()/f.width(),k=k.height()/f.height();0<g&&0<d&&g<f.width()&&d<f.height()&&(g=String(-((c.pageX-h.left)*m-e.width()/2)),d=String(-((c.pageY-h.top)*k-e.height()/2)),e.css({backgroundPosition:g+"px "+d+"px"}),g=String(c.pageX-h.left-e.width()/2),d=String(c.pageY-h.top-e.height()/2),e.css({left:g+"px",top:d+"px"}));a.target=e;n[b]=a;return n},update:function(b,c){b=r(b);var a=n[b],f=a.lens,q=a.target,k=a.overlay,h=a.imageTag,g=a.imgSrc,d=e.extend(a.options,c),m="auto";
""==d.imgSrc&&(g=f.attr("src"));if(""!=d.imgSrc2x&&1<window.devicePixelRatio){var g=d.imgSrc2x,p=new Image;p.onload=function(){m=String(parseInt(this.width/2))+"px"};p.src=g;m=s(p)}else g=d.imgSrc;var p="background-position: 0px 0px;width: "+String(d.lensSize)+"px;height: "+String(d.lensSize)+"px;float: left;display: none;border: "+String(d.borderSize)+"px solid "+d.borderColor+";background-repeat: no-repeat;position: absolute;",l="position: absolute; width: 100%; height: 100%; left: 0; top: 0; background-position: center center; background-repeat: no-repeat; z-index: 1;";
!0===d.overlayAdapt&&(l+="background-position: center center fixed; -webkit-background-size: cover; -moz-background-size: cover; -o-background-size: cover; background-size: cover;");switch(d.lensShape){default:p=p+"border-radius:"+String(d.borderRadius)+"px;";l=l+"border-radius:"+String(d.borderRadius)+"px;";break;case "circle":p=p+"border-radius: "+String(d.lensSize/2+d.borderSize)+"px;",l=l+"border-radius: "+String(d.lensSize/2+d.borderSize)+"px;"}q.attr("style",p);h.attr("src",g);h.css({width:m});
q.css({backgroundImage:"url('"+g+"')",backgroundSize:m+" auto",cursor:"none"});k.attr("style",l);k.css({backgroundImage:"url('"+d.imgOverlay+"')",cursor:"none"});a.lens=f;a.target=q;a.overlay=k;a.options=d;a.imgSrc=g;a.imageTag=h;n[b]=a;return n},destroy:function(b){b=r(b);e.removeData(n[b],this.name);this.removeClass(this.name);this.unbind();this.element=null}};e.fn.mlens=function(b){if(t[b])return t[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof b&&b)e.error("Method "+
b+" does not exist on jQuery.mlens");else return t.init.apply(this,arguments)}})(jQuery);